{"ast":null,"code":"import{supabase}from'./supabase';export async function getReportsData(){try{// Get all fabric entries with related data\nconst{data:entries,error:entriesError}=await supabase.from('fabric_entries').select(\"\\n        *,\\n        quality_parameters (*),\\n        quantity_approvals (*)\\n      \").order('date_inwarded',{ascending:false});if(entriesError)throw entriesError;// Calculate statistics\nconst totalEntries=(entries===null||entries===void 0?void 0:entries.length)||0;const pendingQuality=(entries===null||entries===void 0?void 0:entries.filter(e=>e.status==='PENDING_QUALITY').length)||0;const qualityChecked=(entries===null||entries===void 0?void 0:entries.filter(e=>e.status==='QUALITY_CHECKED').length)||0;const readyToIssue=(entries===null||entries===void 0?void 0:entries.filter(e=>e.status==='READY_TO_ISSUE').length)||0;const onHold=(entries===null||entries===void 0?void 0:entries.filter(e=>e.status==='ON_HOLD').length)||0;// Calculate total quantity (sum of all quantity_value)\nconst totalQuantity=(entries===null||entries===void 0?void 0:entries.reduce((sum,entry)=>sum+(entry.quantity_value||0),0))||0;// Calculate average GSM from quality parameters\nconst entriesWithQuality=(entries===null||entries===void 0?void 0:entries.filter(e=>e.quality_parameters&&e.quality_parameters.length>0))||[];const averageGSM=entriesWithQuality.length>0?entriesWithQuality.reduce((sum,entry)=>{var _entry$quality_parame;return sum+(((_entry$quality_parame=entry.quality_parameters[0])===null||_entry$quality_parame===void 0?void 0:_entry$quality_parame.gsm_value)||0);},0)/entriesWithQuality.length:0;// Get recent entries (last 10)\nconst recentEntries=(entries===null||entries===void 0?void 0:entries.slice(0,10))||[];return{data:{totalEntries,pendingQuality,qualityChecked,readyToIssue,onHold,totalQuantity,averageGSM,recentEntries},error:null};}catch(error){return{data:null,error:error};}}export async function getFabricEntriesWithDetails(){return supabase.from('fabric_entries').select(\"\\n      *,\\n      quality_parameters (*),\\n      quantity_approvals (*),\\n      fabric_rolls (*)\\n    \").order('date_inwarded',{ascending:false});}export async function getStatusDistribution(){const{data,error}=await supabase.from('fabric_entries').select('status');if(error)return{data:null,error};const distribution=(data===null||data===void 0?void 0:data.reduce((acc,entry)=>{acc[entry.status]=(acc[entry.status]||0)+1;return acc;},{}))||{};return{data:distribution,error:null};}export async function getQualityAnalytics(){const{data,error}=await supabase.from('quality_parameters').select('*');if(error)return{data:null,error};const analytics={totalChecked:(data===null||data===void 0?void 0:data.length)||0,averageGSM:(data===null||data===void 0?void 0:data.reduce((sum,q)=>sum+q.gsm_value,0))/((data===null||data===void 0?void 0:data.length)||1)||0,averageWidth:(data===null||data===void 0?void 0:data.reduce((sum,q)=>sum+q.width_dia_inches,0))/((data===null||data===void 0?void 0:data.length)||1)||0,averageShrinkage:(data===null||data===void 0?void 0:data.reduce((sum,q)=>sum+q.shrinkage_percent,0))/((data===null||data===void 0?void 0:data.length)||1)||0,colorFastnessOK:(data===null||data===void 0?void 0:data.filter(q=>q.color_fastness==='OKAY').length)||0,colorFastnessNotOK:(data===null||data===void 0?void 0:data.filter(q=>q.color_fastness==='NOT_OKAY').length)||0};return{data:analytics,error:null};}export async function getApprovalAnalytics(){const{data,error}=await supabase.from('quantity_approvals').select('*');if(error)return{data:null,error};const analytics={totalApprovals:(data===null||data===void 0?void 0:data.length)||0,approved:(data===null||data===void 0?void 0:data.filter(a=>a.approval_status==='APPROVED').length)||0,onHold:(data===null||data===void 0?void 0:data.filter(a=>a.approval_status==='ON_HOLD').length)||0,holdReasons:(data===null||data===void 0?void 0:data.reduce((acc,approval)=>{if(approval.hold_reason){acc[approval.hold_reason]=(acc[approval.hold_reason]||0)+1;}return acc;},{}))||{}};return{data:analytics,error:null};}","map":{"version":3,"names":["supabase","getReportsData","data","entries","error","entriesError","from","select","order","ascending","totalEntries","length","pendingQuality","filter","e","status","qualityChecked","readyToIssue","onHold","totalQuantity","reduce","sum","entry","quantity_value","entriesWithQuality","quality_parameters","averageGSM","_entry$quality_parame","gsm_value","recentEntries","slice","getFabricEntriesWithDetails","getStatusDistribution","distribution","acc","getQualityAnalytics","analytics","totalChecked","q","averageWidth","width_dia_inches","averageShrinkage","shrinkage_percent","colorFastnessOK","color_fastness","colorFastnessNotOK","getApprovalAnalytics","totalApprovals","approved","a","approval_status","holdReasons","approval","hold_reason"],"sources":["/Users/samaysalunke/Documents/everything-hobby/kwabey-fab-check/src/services/reports.service.ts"],"sourcesContent":["import { supabase } from './supabase';\n\nexport async function getReportsData() {\n  try {\n    // Get all fabric entries with related data\n    const { data: entries, error: entriesError } = await supabase\n      .from('fabric_entries')\n      .select(`\n        *,\n        quality_parameters (*),\n        quantity_approvals (*)\n      `)\n      .order('date_inwarded', { ascending: false });\n\n    if (entriesError) throw entriesError;\n\n    // Calculate statistics\n    const totalEntries = entries?.length || 0;\n    const pendingQuality = entries?.filter(e => e.status === 'PENDING_QUALITY').length || 0;\n    const qualityChecked = entries?.filter(e => e.status === 'QUALITY_CHECKED').length || 0;\n    const readyToIssue = entries?.filter(e => e.status === 'READY_TO_ISSUE').length || 0;\n    const onHold = entries?.filter(e => e.status === 'ON_HOLD').length || 0;\n\n    // Calculate total quantity (sum of all quantity_value)\n    const totalQuantity = entries?.reduce((sum, entry) => sum + (entry.quantity_value || 0), 0) || 0;\n\n    // Calculate average GSM from quality parameters\n    const entriesWithQuality = entries?.filter(e => e.quality_parameters && e.quality_parameters.length > 0) || [];\n    const averageGSM = entriesWithQuality.length > 0\n      ? entriesWithQuality.reduce((sum, entry) => sum + (entry.quality_parameters[0]?.gsm_value || 0), 0) / entriesWithQuality.length\n      : 0;\n\n    // Get recent entries (last 10)\n    const recentEntries = entries?.slice(0, 10) || [];\n\n    return {\n      data: {\n        totalEntries,\n        pendingQuality,\n        qualityChecked,\n        readyToIssue,\n        onHold,\n        totalQuantity,\n        averageGSM,\n        recentEntries,\n      },\n      error: null,\n    };\n  } catch (error) {\n    return {\n      data: null,\n      error: error as Error,\n    };\n  }\n}\n\nexport async function getFabricEntriesWithDetails() {\n  return supabase\n    .from('fabric_entries')\n    .select(`\n      *,\n      quality_parameters (*),\n      quantity_approvals (*),\n      fabric_rolls (*)\n    `)\n    .order('date_inwarded', { ascending: false });\n}\n\nexport async function getStatusDistribution() {\n  const { data, error } = await supabase\n    .from('fabric_entries')\n    .select('status');\n\n  if (error) return { data: null, error };\n\n  const distribution = data?.reduce((acc, entry) => {\n    acc[entry.status] = (acc[entry.status] || 0) + 1;\n    return acc;\n  }, {} as Record<string, number>) || {};\n\n  return { data: distribution, error: null };\n}\n\nexport async function getQualityAnalytics() {\n  const { data, error } = await supabase\n    .from('quality_parameters')\n    .select('*');\n\n  if (error) return { data: null, error };\n\n  const analytics = {\n    totalChecked: data?.length || 0,\n    averageGSM: data?.reduce((sum, q) => sum + q.gsm_value, 0) / (data?.length || 1) || 0,\n    averageWidth: data?.reduce((sum, q) => sum + q.width_dia_inches, 0) / (data?.length || 1) || 0,\n    averageShrinkage: data?.reduce((sum, q) => sum + q.shrinkage_percent, 0) / (data?.length || 1) || 0,\n    colorFastnessOK: data?.filter(q => q.color_fastness === 'OKAY').length || 0,\n    colorFastnessNotOK: data?.filter(q => q.color_fastness === 'NOT_OKAY').length || 0,\n  };\n\n  return { data: analytics, error: null };\n}\n\nexport async function getApprovalAnalytics() {\n  const { data, error } = await supabase\n    .from('quantity_approvals')\n    .select('*');\n\n  if (error) return { data: null, error };\n\n  const analytics = {\n    totalApprovals: data?.length || 0,\n    approved: data?.filter(a => a.approval_status === 'APPROVED').length || 0,\n    onHold: data?.filter(a => a.approval_status === 'ON_HOLD').length || 0,\n    holdReasons: data?.reduce((acc, approval) => {\n      if (approval.hold_reason) {\n        acc[approval.hold_reason] = (acc[approval.hold_reason] || 0) + 1;\n      }\n      return acc;\n    }, {} as Record<string, number>) || {},\n  };\n\n  return { data: analytics, error: null };\n} "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}