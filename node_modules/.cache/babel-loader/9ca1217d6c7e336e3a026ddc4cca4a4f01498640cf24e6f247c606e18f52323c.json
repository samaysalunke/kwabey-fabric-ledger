{"ast":null,"code":"import { supabase } from './supabase';\nexport async function getReportsData() {\n  try {\n    // Get all fabric entries with related data\n    const {\n      data: entries,\n      error: entriesError\n    } = await supabase.from('fabric_entries').select(`\n        *,\n        quality_parameters (*),\n        quantity_approvals (*)\n      `).order('date_inwarded', {\n      ascending: false\n    });\n    if (entriesError) throw entriesError;\n\n    // Calculate statistics\n    const totalEntries = (entries === null || entries === void 0 ? void 0 : entries.length) || 0;\n    const pendingQuality = (entries === null || entries === void 0 ? void 0 : entries.filter(e => e.status === 'PENDING_QUALITY').length) || 0;\n    const qualityChecked = (entries === null || entries === void 0 ? void 0 : entries.filter(e => e.status === 'QUALITY_CHECKED').length) || 0;\n    const readyToIssue = (entries === null || entries === void 0 ? void 0 : entries.filter(e => e.status === 'READY_TO_ISSUE').length) || 0;\n    const onHold = (entries === null || entries === void 0 ? void 0 : entries.filter(e => e.status === 'ON_HOLD').length) || 0;\n\n    // Calculate total quantity (sum of all quantity_value)\n    const totalQuantity = (entries === null || entries === void 0 ? void 0 : entries.reduce((sum, entry) => sum + (entry.quantity_value || 0), 0)) || 0;\n\n    // Calculate average GSM from quality parameters\n    const entriesWithQuality = (entries === null || entries === void 0 ? void 0 : entries.filter(e => e.quality_parameters && e.quality_parameters.length > 0)) || [];\n    const averageGSM = entriesWithQuality.length > 0 ? entriesWithQuality.reduce((sum, entry) => {\n      var _entry$quality_parame;\n      return sum + (((_entry$quality_parame = entry.quality_parameters[0]) === null || _entry$quality_parame === void 0 ? void 0 : _entry$quality_parame.gsm_value) || 0);\n    }, 0) / entriesWithQuality.length : 0;\n\n    // Get recent entries (last 10)\n    const recentEntries = (entries === null || entries === void 0 ? void 0 : entries.slice(0, 10)) || [];\n    return {\n      data: {\n        totalEntries,\n        pendingQuality,\n        qualityChecked,\n        readyToIssue,\n        onHold,\n        totalQuantity,\n        averageGSM,\n        recentEntries\n      },\n      error: null\n    };\n  } catch (error) {\n    return {\n      data: null,\n      error: error\n    };\n  }\n}\nexport async function getFabricEntriesWithDetails() {\n  return supabase.from('fabric_entries').select(`\n      *,\n      quality_parameters (*),\n      quantity_approvals (*),\n      fabric_rolls (*)\n    `).order('date_inwarded', {\n    ascending: false\n  });\n}\nexport async function getStatusDistribution() {\n  const {\n    data,\n    error\n  } = await supabase.from('fabric_entries').select('status');\n  if (error) return {\n    data: null,\n    error\n  };\n  const distribution = (data === null || data === void 0 ? void 0 : data.reduce((acc, entry) => {\n    acc[entry.status] = (acc[entry.status] || 0) + 1;\n    return acc;\n  }, {})) || {};\n  return {\n    data: distribution,\n    error: null\n  };\n}\nexport async function getQualityAnalytics() {\n  const {\n    data,\n    error\n  } = await supabase.from('quality_parameters').select('*');\n  if (error) return {\n    data: null,\n    error\n  };\n  const analytics = {\n    totalChecked: (data === null || data === void 0 ? void 0 : data.length) || 0,\n    averageGSM: (data === null || data === void 0 ? void 0 : data.reduce((sum, q) => sum + q.gsm_value, 0)) / ((data === null || data === void 0 ? void 0 : data.length) || 1) || 0,\n    averageWidth: (data === null || data === void 0 ? void 0 : data.reduce((sum, q) => sum + q.width_dia_inches, 0)) / ((data === null || data === void 0 ? void 0 : data.length) || 1) || 0,\n    averageShrinkage: (data === null || data === void 0 ? void 0 : data.reduce((sum, q) => sum + q.shrinkage_percent, 0)) / ((data === null || data === void 0 ? void 0 : data.length) || 1) || 0,\n    colorFastnessOK: (data === null || data === void 0 ? void 0 : data.filter(q => q.color_fastness === 'OKAY').length) || 0,\n    colorFastnessNotOK: (data === null || data === void 0 ? void 0 : data.filter(q => q.color_fastness === 'NOT_OKAY').length) || 0\n  };\n  return {\n    data: analytics,\n    error: null\n  };\n}\nexport async function getApprovalAnalytics() {\n  const {\n    data,\n    error\n  } = await supabase.from('quantity_approvals').select('*');\n  if (error) return {\n    data: null,\n    error\n  };\n  const analytics = {\n    totalApprovals: (data === null || data === void 0 ? void 0 : data.length) || 0,\n    approved: (data === null || data === void 0 ? void 0 : data.filter(a => a.approval_status === 'APPROVED').length) || 0,\n    onHold: (data === null || data === void 0 ? void 0 : data.filter(a => a.approval_status === 'ON_HOLD').length) || 0,\n    holdReasons: (data === null || data === void 0 ? void 0 : data.reduce((acc, approval) => {\n      if (approval.hold_reason) {\n        acc[approval.hold_reason] = (acc[approval.hold_reason] || 0) + 1;\n      }\n      return acc;\n    }, {})) || {}\n  };\n  return {\n    data: analytics,\n    error: null\n  };\n}","map":{"version":3,"names":["supabase","getReportsData","data","entries","error","entriesError","from","select","order","ascending","totalEntries","length","pendingQuality","filter","e","status","qualityChecked","readyToIssue","onHold","totalQuantity","reduce","sum","entry","quantity_value","entriesWithQuality","quality_parameters","averageGSM","_entry$quality_parame","gsm_value","recentEntries","slice","getFabricEntriesWithDetails","getStatusDistribution","distribution","acc","getQualityAnalytics","analytics","totalChecked","q","averageWidth","width_dia_inches","averageShrinkage","shrinkage_percent","colorFastnessOK","color_fastness","colorFastnessNotOK","getApprovalAnalytics","totalApprovals","approved","a","approval_status","holdReasons","approval","hold_reason"],"sources":["/Users/samaysalunke/Documents/everything-hobby/kwabey-fab-check/src/services/reports.service.ts"],"sourcesContent":["import { supabase } from './supabase';\n\nexport async function getReportsData() {\n  try {\n    // Get all fabric entries with related data\n    const { data: entries, error: entriesError } = await supabase\n      .from('fabric_entries')\n      .select(`\n        *,\n        quality_parameters (*),\n        quantity_approvals (*)\n      `)\n      .order('date_inwarded', { ascending: false });\n\n    if (entriesError) throw entriesError;\n\n    // Calculate statistics\n    const totalEntries = entries?.length || 0;\n    const pendingQuality = entries?.filter(e => e.status === 'PENDING_QUALITY').length || 0;\n    const qualityChecked = entries?.filter(e => e.status === 'QUALITY_CHECKED').length || 0;\n    const readyToIssue = entries?.filter(e => e.status === 'READY_TO_ISSUE').length || 0;\n    const onHold = entries?.filter(e => e.status === 'ON_HOLD').length || 0;\n\n    // Calculate total quantity (sum of all quantity_value)\n    const totalQuantity = entries?.reduce((sum, entry) => sum + (entry.quantity_value || 0), 0) || 0;\n\n    // Calculate average GSM from quality parameters\n    const entriesWithQuality = entries?.filter(e => e.quality_parameters && e.quality_parameters.length > 0) || [];\n    const averageGSM = entriesWithQuality.length > 0\n      ? entriesWithQuality.reduce((sum, entry) => sum + (entry.quality_parameters[0]?.gsm_value || 0), 0) / entriesWithQuality.length\n      : 0;\n\n    // Get recent entries (last 10)\n    const recentEntries = entries?.slice(0, 10) || [];\n\n    return {\n      data: {\n        totalEntries,\n        pendingQuality,\n        qualityChecked,\n        readyToIssue,\n        onHold,\n        totalQuantity,\n        averageGSM,\n        recentEntries,\n      },\n      error: null,\n    };\n  } catch (error) {\n    return {\n      data: null,\n      error: error as Error,\n    };\n  }\n}\n\nexport async function getFabricEntriesWithDetails() {\n  return supabase\n    .from('fabric_entries')\n    .select(`\n      *,\n      quality_parameters (*),\n      quantity_approvals (*),\n      fabric_rolls (*)\n    `)\n    .order('date_inwarded', { ascending: false });\n}\n\nexport async function getStatusDistribution() {\n  const { data, error } = await supabase\n    .from('fabric_entries')\n    .select('status');\n\n  if (error) return { data: null, error };\n\n  const distribution = data?.reduce((acc, entry) => {\n    acc[entry.status] = (acc[entry.status] || 0) + 1;\n    return acc;\n  }, {} as Record<string, number>) || {};\n\n  return { data: distribution, error: null };\n}\n\nexport async function getQualityAnalytics() {\n  const { data, error } = await supabase\n    .from('quality_parameters')\n    .select('*');\n\n  if (error) return { data: null, error };\n\n  const analytics = {\n    totalChecked: data?.length || 0,\n    averageGSM: data?.reduce((sum, q) => sum + q.gsm_value, 0) / (data?.length || 1) || 0,\n    averageWidth: data?.reduce((sum, q) => sum + q.width_dia_inches, 0) / (data?.length || 1) || 0,\n    averageShrinkage: data?.reduce((sum, q) => sum + q.shrinkage_percent, 0) / (data?.length || 1) || 0,\n    colorFastnessOK: data?.filter(q => q.color_fastness === 'OKAY').length || 0,\n    colorFastnessNotOK: data?.filter(q => q.color_fastness === 'NOT_OKAY').length || 0,\n  };\n\n  return { data: analytics, error: null };\n}\n\nexport async function getApprovalAnalytics() {\n  const { data, error } = await supabase\n    .from('quantity_approvals')\n    .select('*');\n\n  if (error) return { data: null, error };\n\n  const analytics = {\n    totalApprovals: data?.length || 0,\n    approved: data?.filter(a => a.approval_status === 'APPROVED').length || 0,\n    onHold: data?.filter(a => a.approval_status === 'ON_HOLD').length || 0,\n    holdReasons: data?.reduce((acc, approval) => {\n      if (approval.hold_reason) {\n        acc[approval.hold_reason] = (acc[approval.hold_reason] || 0) + 1;\n      }\n      return acc;\n    }, {} as Record<string, number>) || {},\n  };\n\n  return { data: analytics, error: null };\n} "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}